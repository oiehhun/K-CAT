{"version":3,"file":"test-utils.js","sourceRoot":"","sources":["../../../src/lib/storage/test-utils.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mDAAqC;AACrC,uCAAyB;AACzB,uDAAoD;AACpD,qEAA+F;AAE/F,MAAM,IAAI,GAAG,SAAS,GAAG,gBAAgB,CAAC;AAC1C,IAAI,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE;IACxB,GAAG,CAAC,IAAI,CAAC,CAAC;CACV;AAED,SAAgB,oBAAoB,CAAC,OAAoB,EAAE,KAAoC;IAC9F,IAAI,GAAyB,CAAC;IAE9B,OAAO,CAAC,UAAU,CAAC,KAAK,IAAI,EAAE;QAC7B,GAAG,GAAG,MAAM,IAAA,8CAAyB,EAAC;YACrC,SAAS,EAAE,yBAAyB;YACpC,SAAS,EAAE;gBACV,IAAI,EAAE,WAAW;gBACjB,IAAI,EAAE,IAAI;aACV;SACD,CAAC,CAAC;QACH,MAAM,GAAG,CAAC,cAAc,EAAE,CAAC;QAC3B,MAAM,SAAS,GAAG,IAAI,qBAAS,CAAC;YAC/B,SAAS,EAAE,GAAG,CAAC,SAAS;YACxB,IAAI,EAAE,GAAG,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI;YAClC,IAAI,EAAE,GAAG,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI;YAClC,GAAG,EAAE,KAAK;SACV,CAAC,CAAC;QACH,MAAM,KAAK,CAAC,SAAS,CAAC,CAAC;IACxB,CAAC,CAAC,CAAC;IAEH,OAAO,CAAC,SAAS,CAAC,KAAK,IAAI,EAAE;QAC5B,IAAI,GAAG,EAAE;YACR,MAAM,GAAG,CAAC,OAAO,EAAE,CAAC;SACpB;IACF,CAAC,CAAC,CAAC;AACJ,CAAC;AA1BD,oDA0BC","sourcesContent":["import * as env from 'node-env-file';\nimport * as fs from 'fs';\nimport { Firestore } from '@google-cloud/firestore';\nimport { initializeTestEnvironment, RulesTestEnvironment } from '@firebase/rules-unit-testing';\n\nconst path = __dirname + '/../../../.env';\nif (fs.existsSync(path)) {\n\tenv(path);\n}\n\nexport function createFirestoreTests(context: Mocha.Suite, setup: (firestore: Firestore) => any) {\n\tlet app: RulesTestEnvironment;\n\n\tcontext.beforeEach(async () => {\n\t\tapp = await initializeTestEnvironment({\n\t\t\tprojectId: 'firestore-storage-local',\n\t\t\tfirestore: {\n\t\t\t\thost: '127.0.0.1',\n\t\t\t\tport: 8080,\n\t\t\t},\n\t\t});\n\t\tawait app.clearFirestore();\n\t\tconst firestore = new Firestore({\n\t\t\tprojectId: app.projectId,\n\t\t\thost: app.emulators.firestore.host,\n\t\t\tport: app.emulators.firestore.port,\n\t\t\tssl: false,\n\t\t});\n\t\tawait setup(firestore);\n\t});\n\n\tcontext.afterEach(async () => {\n\t\tif (app) {\n\t\t\tawait app.cleanup();\n\t\t}\n\t});\n}\n"]}