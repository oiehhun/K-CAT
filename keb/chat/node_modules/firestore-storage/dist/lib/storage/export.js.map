{"version":3,"file":"export.js","sourceRoot":"","sources":["../../../src/lib/storage/export.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,mEAAqD;AACrD,2CAA6B;AAEtB,KAAK,UAAU,eAAe,CAAC,SAAiB,EAAE,UAAkB,EAAE,GAAW,EAAE,aAAwB;IACjH,MAAM,MAAM,GAAG,IAAI,SAAS,CAAC,EAAE,CAAC,oBAAoB,EAAE,CAAC;IACvD,MAAM,YAAY,GAAG,MAAM,CAAC,YAAY,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;IAEjE,OAAO,MAAM;SACX,eAAe,CAAC;QAChB,IAAI,EAAE,YAAY;QAClB,eAAe,EAAE,QAAQ,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,GAAG,CAAC,EAAE;QACrD,sDAAsD;QACtD,gDAAgD;QAChD,oCAAoC;QACpC,aAAa,EAAE,aAAa,IAAI,EAAE;KAClC,CAAC;SACD,IAAI,CAAC,CAAC,SAAS,EAAE,EAAE;QACnB,MAAM,QAAQ,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;QAC9B,OAAO,CAAC,GAAG,CAAC,mBAAmB,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;IACpD,CAAC,CAAC;SACD,KAAK,CAAC,CAAC,GAAG,EAAE,EAAE;QACd,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACnB,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;IAC5C,CAAC,CAAC,CAAC;AACL,CAAC;AArBD,0CAqBC","sourcesContent":["import * as firestore from '@google-cloud/firestore';\nimport * as path from 'path';\n\nexport async function exportFirestore(projectId: string, bucketName: string, dir: string, collectionIds?: string[]) {\n\tconst client = new firestore.v1.FirestoreAdminClient();\n\tconst databaseName = client.databasePath(projectId, '(default)');\n\n\treturn client\n\t\t.exportDocuments({\n\t\t\tname: databaseName,\n\t\t\toutputUriPrefix: `gs://${path.join(bucketName, dir)}`,\n\t\t\t// Leave collectionIds empty to export all collections\n\t\t\t// or set to a list of collection IDs to export,\n\t\t\t// collectionIds: ['users', 'posts']\n\t\t\tcollectionIds: collectionIds || [],\n\t\t})\n\t\t.then((responses) => {\n\t\t\tconst response = responses[0];\n\t\t\tconsole.log(`Operation Name: ${response['name']}`);\n\t\t})\n\t\t.catch((err) => {\n\t\t\tconsole.error(err);\n\t\t\tthrow new Error('Export operation failed');\n\t\t});\n}\n"]}