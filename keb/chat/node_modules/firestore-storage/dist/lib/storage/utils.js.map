{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../src/lib/storage/utils.ts"],"names":[],"mappings":";;;AAWA,SAAgB,UAAU,CACzB,SAAoB,EACpB,IAAkC,EAClC,IAA4D,EAC5D,GAAwB,EACxB,EAAqE;IAErE,MAAM,CAAC,GAAG,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;IACzC,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;IAC5B,MAAM,MAAM,GAAG,CAAC,CAAC,EAAE;QAClB,CAAC,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC/D,CAAC,CAAC,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC;IAEpD,OAAO,EAAE,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;AACtC,CAAC;AAdD,gCAcC","sourcesContent":["import {\n\tBaseModel,\n\tBaseRepository,\n\tCollectionIds,\n\tCollectionPath,\n\tModelDataOnly,\n\tModelDataWithId,\n\tPatchUpdate,\n} from 'firestore-storage-core';\nimport { DocumentReference, Firestore } from '@google-cloud/firestore';\n\nexport function applyToDoc<T extends BaseModel, Path extends CollectionPath<any, any, any>, R = void>(\n\tfirestore: Firestore,\n\trepo: BaseRepository<T, Path, any>,\n\tdata: T | ModelDataOnly<T> | PatchUpdate<ModelDataWithId<T>>,\n\tids: CollectionIds<Path>,\n\tcb: (id: string, data: ModelDataOnly<T>, doc: DocumentReference) => R\n) {\n\tconst d = repo.toFirestoreDocument(data);\n\tconst path = repo.getPath();\n\tconst docRef = d.id\n\t\t? firestore.doc(repo.getDocumentPath(path.toDocIds(ids, d.id)))\n\t\t: firestore.collection(path.collection(ids)).doc();\n\n\treturn cb(docRef.id, d.data, docRef);\n}\n"]}